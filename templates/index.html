<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Performance Predictor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background: #f8f9fa;
            margin: 0;
            padding: 0;
        }

        /* Google Cloud Top Bar */
        .top-bar {
            background: #fff;
            border-bottom: 1px solid #e8eaed;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .google-logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 20px;
            font-weight: 400;
            color: #5f6368;
        }

        .google-logo span:nth-child(1) { color: #4285f4; }
        .google-logo span:nth-child(2) { color: #ea4335; }
        .google-logo span:nth-child(3) { color: #fbbc04; }
        .google-logo span:nth-child(4) { color: #34a853; }

        .product-name {
            font-size: 18px;
            color: #5f6368;
            margin-left: 8px;
            padding-left: 16px;
            border-left: 1px solid #e8eaed;
        }

        .container {
            max-width: 1800px;
            margin: 24px auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
            padding: 0;
            overflow: hidden;
        }

        .header {
            padding: 24px 32px;
            border-bottom: 1px solid #e8eaed;
            background: #fff;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            color: #1967d2;
            margin: 0;
            font-weight: 400;
        }

        .header p {
            font-size: 13px;
            color: #5f6368;
            margin: 4px 0 0 0;
        }

        .content-area {
            padding: 24px 32px;
        }

        /* Budget Section - Google Cloud Style */
        .budget-section {
            margin-bottom: 24px;
        }

        .budget-label {
            font-size: 14px;
            color: #5f6368;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .budget-input-wrapper {
            position: relative;
            display: inline-block;
        }

        .budget-input {
            background: #fff;
            padding: 12px 16px;
            font-size: 14px;
            font-weight: 400;
            border: 1px solid #dadce0;
            border-radius: 4px;
            width: 300px;
            outline: none;
            color: #202124;
            transition: all 0.2s ease;
            font-family: 'Open Sans', sans-serif;
        }

        .budget-input:hover {
            border-color: #5f6368;
            background: #f8f9fa;
        }

        .budget-input:focus {
            border-color: #1967d2;
            border-width: 2px;
            padding: 11px 15px;
            background: #fff;
        }

        .budget-input::placeholder {
            color: #80868b;
        }

        /* Action Buttons - Google Cloud Style */
        .actions {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
        }

        .btn {
            padding: 10px 24px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            font-family: 'Open Sans', sans-serif;
            letter-spacing: 0.25px;
            text-transform: uppercase;
            font-size: 13px;
        }

        .btn:hover {
            box-shadow: 0 1px 2px 0 rgba(60,64,67,.3), 0 1px 3px 1px rgba(60,64,67,.15);
        }

        .btn:active {
            box-shadow: 0 1px 2px 0 rgba(60,64,67,.3);
            transform: translateY(1px);
        }

        .btn-add {
            background: #fef7e0;
            color: #202124;
            border-color: #fbbc04;
        }

        .btn-add:hover {
            background: #feefc3;
            border-color: #f9ab00;
        }

        .btn-clear {
            background: #fff;
            color: #5f6368;
            border-color: #dadce0;
        }

        .btn-clear:hover {
            background: #f8f9fa;
            border-color: #5f6368;
        }

        .btn-predict-all {
            background: #1967d2;
            color: white;
            border-color: #1967d2;
        }

        .btn-predict-all:hover {
            background: #1557b0;
            box-shadow: 0 1px 2px 0 rgba(66,133,244,.3), 0 1px 3px 1px rgba(66,133,244,.15);
        }

        .btn-predict-all:disabled {
            opacity: 0.38;
            cursor: not-allowed;
        }

        /* Table Section - Google Cloud Style */
        .table-container {
            overflow-x: auto;
            border: 1px solid #dadce0;
            border-radius: 8px;
            background: #fff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            background: #f8f9fa;
            padding: 16px 24px;
            text-align: center;
            font-weight: 500;
            color: #5f6368;
            border-bottom: 1px solid #e8eaed;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 16px 24px;
            border-bottom: 1px solid #e8eaed;
            text-align: center;
            color: #202124;
            font-size: 13px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .input-cell {
            background: #fef7e0 !important;
            padding: 0 !important;
        }

        .input-cell select,
        .input-cell input {
            width: 100%;
            padding: 8px 12px;
            border: none;
            background: transparent;
            font-size: 13px;
            text-align: center;
            font-weight: 400;
            color: #202124;
            outline: none;
            font-family: 'Open Sans', sans-serif;
        }

        .input-cell select:focus,
        .input-cell input:focus {
            background: #feefc3;
        }

        .input-cell select {
            cursor: pointer;
        }

        .input-cell input::placeholder {
            color: #80868b;
        }

        .allocated-budget-cell {
            background: #fef7e0 !important;
            font-weight: 500;
            font-size: 13px;
            color: #202124;
        }

        .prediction-cell {
            background: #e8f0fe !important;
            font-weight: 500;
            font-size: 13px;
            color: #1967d2;
        }

        .total-row {
            background: #e6f4ea !important;
            font-weight: 600;
            font-size: 13px;
        }

        .total-row td {
            background: #e6f4ea !important;
            color: #137333;
            border-top: 2px solid #34a853 !important;
        }

        .btn-delete-row {
            background: transparent;
            color: #5f6368;
            border: 1px solid #dadce0;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            font-size: 12px;
            transition: all 0.2s ease;
            font-family: 'Open Sans', sans-serif;
        }

        .btn-delete-row:hover {
            background: #f8f9fa;
            border-color: #ea4335;
            color: #ea4335;
        }

        /* Stats Footer */
        .stats-footer {
            margin-top: 20px;
            padding: 20px;
            background: #f1f3f4;
            border-radius: 8px;
            border: 1px solid #dadce0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.12);
        }

        .stats-footer h3 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: #202124;
            font-weight: 600;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }

        .stat-item {
            font-size: 0.85rem;
            color: #5f6368;
        }

        .stat-item strong {
            color: #202124;
            font-weight: 600;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 10px;
            display: none;
            color: #4285f4;
            font-weight: 600;
        }

        .loading.show {
            display: block;
        }

        .error {
            background: #fce8e6;
            border: 1px solid #ea4335;
            color: #c5221f;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-weight: 500;
        }

        .error.show {
            display: block;
        }

        .success {
            background: #e6f4ea;
            border: 1px solid #34a853;
            color: #137333;
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-weight: 500;
        }

        .success.show {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #5f6368;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .container {
            box-shadow: 0 1px 6px rgba(0,0,0,0.12);
        }
    </style>
</head>
<body>
    <!-- Google Cloud Top Bar -->
    <div class="top-bar">
        <div class="google-logo">
            <span>G</span><span>o</span><span>o</span><span>g</span><span>l</span><span style="color:#ea4335;">e</span>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>Campaign Performance Predictor</h1>
            <p>Predict impressions and engagement for social media campaigns</p>
        </div>

        <div class="content-area">
            <!-- Overall Budget -->
            <div class="budget-section">
                <div class="budget-label">Overall Budget ($)</div>
                <div class="budget-input-wrapper">
                    <input type="number" id="totalBudget" class="budget-input" placeholder="Enter budget amount" value="1000" min="1">
                </div>
            </div>

        <!-- Error/Success Messages -->
        <div class="error" id="errorMsg"></div>
        <div class="success" id="successMsg"></div>
        <div class="loading" id="loading">‚è≥ Processing predictions...</div>

        <!-- Actions -->
        <div class="actions">
            <button class="btn btn-add" onclick="addRow()">+ Add Campaign</button>
            <button class="btn btn-predict-all" onclick="predictAllCampaigns()">üîÆ Predict All Campaigns</button>
            <button class="btn btn-clear" onclick="clearAll()">Clear All</button>
        </div>

        <!-- Campaign Table -->
        <div class="table-container">
            <table id="campaignTable">
                <thead>
                    <tr>
                        <th>Platform</th>
                        <th>Campaign Type</th>
                        <th>Content Type</th>
                        <th>Budget<br>Allocation (%)</th>
                        <th>Allocated<br>Budget ($)</th>
                        <th>Impressions<br>Prediction</th>
                        <th>Engagement<br>Prediction</th>
                        <th>CPM</th>
                        <th>Cost per<br>Engagement</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <tbody id="campaignTableBody">
                    <!-- Rows will be added dynamically -->
                </tbody>
                <tfoot id="totalRow" style="display: none;">
                    <tr class="total-row">
                        <td colspan="3" style="text-align: right; font-weight: 900;">TOTAL</td>
                        <td id="totalBudgetPct">-</td>
                        <td id="totalBudgetAmount">-</td>
                        <td id="totalImpressions">-</td>
                        <td id="totalEngagement">-</td>
                        <td id="avgCPM">-</td>
                        <td id="avgCPE">-</td>
                        <td>-</td>
                    </tr>
                </tfoot>
            </table>
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">üìä</div>
                <p>No campaigns added yet. Click "Add Campaign" to get started.</p>
            </div>
        </div>

            <!-- Statistics Footer -->
            <div class="stats-footer">
                <h3>Model Information & Statistical Metrics</h3>

                <!-- Dataset Information -->
                <div class="stat-section">
                    <h4 style="color: #1967d2; font-size: 14px; margin-bottom: 12px; font-weight: 600;">Dataset & Training</h4>
                    <div class="stats-grid">
                        <div class="stat-item"><strong>Model:</strong> <span id="model-name">Loading...</span></div>
                        <div class="stat-item"><strong>Training Samples:</strong> <span id="train-samples">Loading...</span></div>
                        <div class="stat-item"><strong>Testing Samples:</strong> <span id="test-samples">Loading...</span></div>
                        <div class="stat-item"><strong>Input Features:</strong> <span id="features-count">4</span> (Platform, Campaign Type, Content Type, Spend)</div>
                        <div class="stat-item"><strong>Target Variables:</strong> <span id="targets-count">2</span> (Impressions, Engagement)</div>
                    </div>
                </div>

                <!-- Model Performance -->
                <div class="stat-section">
                    <h4 style="color: #1967d2; font-size: 14px; margin-bottom: 12px; margin-top: 20px; font-weight: 600;">Model Performance (Test Set)</h4>
                    <div class="stats-grid">
                        <div class="stat-item"><strong>Average R¬≤ Score:</strong> <span id="avg-r2">Loading...</span></div>
                        <div class="stat-item"><strong>Impressions R¬≤:</strong> <span id="impressions-r2">Loading...</span></div>
                        <div class="stat-item"><strong>Engagement R¬≤:</strong> <span id="engagement-r2">Loading...</span></div>
                    </div>
                </div>

            </div>
        </div> <!-- End content-area -->
    </div> <!-- End container -->

    <script>
        const PLATFORMS = ['TikTok', 'Instagram', 'Meta'];
        const CAMPAIGN_TYPES = ['Flood The Feed', 'Bau', 'Mm'];
        const CONTENT_TYPES = [
            'Influencer - Cfg - Boosted Only',
            'Influencer - Ogilvy - Organic Only',
            'Owned - Boosted Only',
            'Owned - Organic Only',
            'Paid - Brand',
            'Paid - Partnership'
        ];

        let rowCounter = 0;

        function showError(message) {
            const errorDiv = document.getElementById('errorMsg');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            setTimeout(() => errorDiv.classList.remove('show'), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.getElementById('successMsg');
            successDiv.textContent = message;
            successDiv.classList.add('show');
            setTimeout(() => successDiv.classList.remove('show'), 3000);
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('show', show);
        }

        function updateEmptyState() {
            const tbody = document.getElementById('campaignTableBody');
            const emptyState = document.getElementById('emptyState');

            if (tbody.children.length === 0) {
                emptyState.style.display = 'block';
            } else {
                emptyState.style.display = 'none';
            }
        }

        function addRow() {
            const tbody = document.getElementById('campaignTableBody');
            const row = tbody.insertRow();
            const rowId = rowCounter++;

            row.id = `row_${rowId}`;

            // Platform
            let cell = row.insertCell();
            cell.className = 'input-cell';
            cell.innerHTML = `
                <select id="platform_${rowId}">
                    <option value="">Select...</option>
                    ${PLATFORMS.map(p => `<option value="${p}">${p}</option>`).join('')}
                </select>
            `;

            // Campaign Type
            cell = row.insertCell();
            cell.className = 'input-cell';
            cell.innerHTML = `
                <select id="campaign_type_${rowId}">
                    <option value="">Select...</option>
                    ${CAMPAIGN_TYPES.map(c => `<option value="${c}">${c}</option>`).join('')}
                </select>
            `;

            // Content Type
            cell = row.insertCell();
            cell.className = 'input-cell';
            cell.innerHTML = `
                <select id="content_type_${rowId}">
                    <option value="">Select...</option>
                    ${CONTENT_TYPES.map(c => `<option value="${c}">${c}</option>`).join('')}
                </select>
            `;

            // Budget Allocation %
            cell = row.insertCell();
            cell.className = 'input-cell';
            cell.innerHTML = `<input type="number" id="budget_pct_${rowId}" placeholder="0" min="0" max="100" step="0.1" oninput="updateAllocatedBudget(${rowId})">`;

            // Allocated Budget (calculated)
            cell = row.insertCell();
            cell.id = `allocated_budget_${rowId}`;
            cell.className = 'allocated-budget-cell';
            cell.textContent = '$0';

            // Impressions
            cell = row.insertCell();
            cell.className = 'prediction-cell';
            cell.id = `impressions_${rowId}`;
            cell.textContent = '-';

            // Engagement
            cell = row.insertCell();
            cell.className = 'prediction-cell';
            cell.id = `engagement_${rowId}`;
            cell.textContent = '-';

            // CPM
            cell = row.insertCell();
            cell.className = 'prediction-cell';
            cell.id = `cpm_${rowId}`;
            cell.textContent = '-';

            // Cost per Engagement
            cell = row.insertCell();
            cell.className = 'prediction-cell';
            cell.id = `cpe_${rowId}`;
            cell.textContent = '-';

            // Delete Button
            cell = row.insertCell();
            cell.innerHTML = `<button class="btn-delete-row" onclick="deleteRow(${rowId})">‚úï</button>`;

            updateEmptyState();
        }

        function deleteRow(rowId) {
            const row = document.getElementById(`row_${rowId}`);
            if (row) {
                row.remove();
                updateEmptyState();
                updateTotals();
            }
        }

        function updateAllocatedBudget(rowId) {
            const budgetPct = parseFloat(document.getElementById(`budget_pct_${rowId}`).value) || 0;
            const totalBudget = parseFloat(document.getElementById('totalBudget').value) || 0;
            const allocatedBudget = (budgetPct / 100) * totalBudget;
            document.getElementById(`allocated_budget_${rowId}`).textContent = '$' + allocatedBudget.toLocaleString(undefined, {maximumFractionDigits: 2});
            updateTotals();
        }

        function updateTotals() {
            const tbody = document.getElementById('campaignTableBody');
            const rows = tbody.getElementsByTagName('tr');

            if (rows.length === 0) {
                document.getElementById('totalRow').style.display = 'none';
                return;
            }

            let totalBudgetPct = 0;
            let totalBudgetAmount = 0;
            let totalImpressions = 0;
            let totalEngagement = 0;
            let totalSpendForCPM = 0;
            let totalSpendForCPE = 0;
            let countCPM = 0;
            let countCPE = 0;

            for (let row of rows) {
                const rowId = row.id.replace('row_', '');

                // Budget percentage
                const budgetPct = parseFloat(document.getElementById(`budget_pct_${rowId}`).value) || 0;
                totalBudgetPct += budgetPct;

                // Budget amount
                const totalBudget = parseFloat(document.getElementById('totalBudget').value) || 0;
                const allocatedBudget = (budgetPct / 100) * totalBudget;
                totalBudgetAmount += allocatedBudget;

                // Impressions
                const impressionsText = document.getElementById(`impressions_${rowId}`).textContent;
                if (impressionsText !== '-') {
                    const impressions = parseFloat(impressionsText.replace(/,/g, ''));
                    totalImpressions += impressions;
                }

                // Engagement
                const engagementText = document.getElementById(`engagement_${rowId}`).textContent;
                if (engagementText !== '-') {
                    const engagement = parseFloat(engagementText.replace(/,/g, ''));
                    totalEngagement += engagement;
                }

                // CPM for averaging
                const cpmText = document.getElementById(`cpm_${rowId}`).textContent;
                if (cpmText !== '-') {
                    totalSpendForCPM += allocatedBudget;
                    countCPM++;
                }

                // CPE for averaging
                const cpeText = document.getElementById(`cpe_${rowId}`).textContent;
                if (cpeText !== '-') {
                    totalSpendForCPE += allocatedBudget;
                    countCPE++;
                }
            }

            // Update total row
            document.getElementById('totalBudgetPct').textContent = totalBudgetPct.toFixed(1) + '%';
            document.getElementById('totalBudgetAmount').textContent = '$' + totalBudgetAmount.toLocaleString(undefined, {maximumFractionDigits: 2});
            document.getElementById('totalImpressions').textContent = totalImpressions > 0 ? totalImpressions.toLocaleString() : '-';
            document.getElementById('totalEngagement').textContent = totalEngagement > 0 ? totalEngagement.toLocaleString() : '-';

            // Calculate weighted average CPM and CPE
            if (totalImpressions > 0 && totalSpendForCPM > 0) {
                const avgCPM = (totalSpendForCPM / totalImpressions) * 1000;
                document.getElementById('avgCPM').textContent = '$' + avgCPM.toFixed(2);
            } else {
                document.getElementById('avgCPM').textContent = '-';
            }

            if (totalEngagement > 0 && totalSpendForCPE > 0) {
                const avgCPE = totalSpendForCPE / totalEngagement;
                document.getElementById('avgCPE').textContent = '$' + avgCPE.toFixed(2);
            } else {
                document.getElementById('avgCPE').textContent = '-';
            }

            document.getElementById('totalRow').style.display = '';
        }

        async function predictAllCampaigns() {
            const tbody = document.getElementById('campaignTableBody');
            const rows = tbody.getElementsByTagName('tr');

            if (rows.length === 0) {
                showError('Please add at least one campaign before predicting');
                return;
            }

            const totalBudget = parseFloat(document.getElementById('totalBudget').value);
            if (!totalBudget || totalBudget <= 0) {
                showError('Please enter a valid overall budget');
                return;
            }

            showLoading(true);
            let successCount = 0;
            let errorCount = 0;

            for (let row of rows) {
                const rowId = row.id.replace('row_', '');

                const platform = document.getElementById(`platform_${rowId}`).value;
                const campaignType = document.getElementById(`campaign_type_${rowId}`).value;
                const contentType = document.getElementById(`content_type_${rowId}`).value;
                const budgetPct = parseFloat(document.getElementById(`budget_pct_${rowId}`).value);

                // Validation
                if (!platform || !campaignType || !contentType) {
                    errorCount++;
                    continue;
                }

                if (!budgetPct || budgetPct <= 0) {
                    errorCount++;
                    continue;
                }

                const totalSpend = (budgetPct / 100) * totalBudget;

                try {
                    const response = await fetch('/api/predict', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            total_spend: totalSpend,
                            platform: platform,
                            campaign_type: campaignType,
                            content_type: contentType
                        })
                    });

                    const data = await response.json();

                    if (data.status === 'error') {
                        errorCount++;
                        continue;
                    }

                    // Update results
                    document.getElementById(`impressions_${rowId}`).textContent =
                        data.predictions.impressions.toLocaleString();
                    document.getElementById(`engagement_${rowId}`).textContent =
                        data.predictions.engagement.toLocaleString();
                    document.getElementById(`cpm_${rowId}`).textContent =
                        '$' + data.metrics.cpm.toFixed(2);
                    document.getElementById(`cpe_${rowId}`).textContent =
                        '$' + data.metrics.cost_per_engagement.toFixed(2);

                    successCount++;

                } catch (error) {
                    errorCount++;
                }
            }

            showLoading(false);
            updateTotals();

            if (successCount > 0 && errorCount === 0) {
                showSuccess(`‚úÖ Successfully predicted ${successCount} campaign(s)`);
            } else if (successCount > 0 && errorCount > 0) {
                showError(`‚ö†Ô∏è Predicted ${successCount} campaign(s), ${errorCount} failed (check inputs)`);
            } else {
                showError('‚ùå All predictions failed. Please check your inputs.');
            }
        }

        function clearAll() {
            if (!confirm('Are you sure you want to clear all campaigns?')) {
                return;
            }

            const tbody = document.getElementById('campaignTableBody');
            tbody.innerHTML = '';
            rowCounter = 0;
            updateEmptyState();
            updateTotals();
            showSuccess('All campaigns cleared');
        }

        // Update budget allocations when overall budget changes
        document.getElementById('totalBudget').addEventListener('input', function() {
            const tbody = document.getElementById('campaignTableBody');
            const rows = tbody.getElementsByTagName('tr');
            for (let row of rows) {
                const rowId = row.id.replace('row_', '');
                updateAllocatedBudget(rowId);
            }
        });

        // Load model information from API
        async function loadModelInfo() {
            try {
                const response = await fetch('/api/model-info');
                const data = await response.json();

                if (data.status === 'success' && data.model_info) {
                    const info = data.model_info;

                    // Update dataset information
                    document.getElementById('model-name').textContent = info.model_name || 'Unknown';
                    document.getElementById('train-samples').textContent = `${info.dataset?.training_samples || 0} (${info.dataset?.train_test_split?.split('/')[0] || '80'}%)`;
                    document.getElementById('test-samples').textContent = `${info.dataset?.testing_samples || 0} (${info.dataset?.train_test_split?.split('/')[1] || '20'}%)`;
                    document.getElementById('features-count').textContent = info.dataset?.features_count || 4;
                    document.getElementById('targets-count').textContent = info.dataset?.target_variables || 2;

                    // Update model performance
                    document.getElementById('avg-r2').textContent = (info.avg_test_r2 || 0).toFixed(3);
                    document.getElementById('impressions-r2').textContent = (info.impressions?.test_r2 || 0).toFixed(3);
                    document.getElementById('engagement-r2').textContent = (info.engagement?.test_r2 || 0).toFixed(3);
                } else {
                    console.error('Failed to load model info:', data);
                }
            } catch (error) {
                console.error('Error fetching model info:', error);
                // Keep "Loading..." text on error
            }
        }

        // Initialize with empty state
        window.onload = function() {
            updateEmptyState();
            updateTotals();
            loadModelInfo();
        };
    </script>
</body>
</html>
